{% load static %}

{% with events=period.get_occurrences %}{% if events %}

<ol class="event-details">
{% for e in events %}
	<li>
	{% with location=e.event.eventlocation.location %}
		<article id="evento-{{ e.event.id }}">
			<h1>{{ e.title }}</h1>

			{% if location %}
			<div class="location">
				<a href="#">
					<strong>{{ location.title }}</strong>
					<address>{{ location.address }}, {{ location.zipcode }} {{ location.city }}</address>
				</a>
				<img src="{{ location.static_url }}" width="350" height="150" />
			</div>
			{% endif %}

			<time>
				dal <span>{{ e.start|date:"d F"|capfirst }}</span>
				dalle <span>{{ e.start|date:"H:i" }}</span>
				{% if e.start.date < e.end.date %}
				al <span>{{ e.end|date:"d F Y"|capfirst }}</span>
				{% endif %}
				alle <span>{{ e.end|date:"H:i" }}</span>
			</time>

			<div class="description">
				{{ e.description|linebreaks }}
			</div>
		</article>
		{% endwith %}
	</li>
{% endfor %}
</ol>
{% endif %}
{% endwith %}


{% comment %}
{% load i18n sekizai_tags %}
{% addtoblock "js" %}<script type="text/javascript" src="https://maps-api-ssl.google.com/maps/api/js?v=3&sensor=true"></script>{% endaddtoblock %}
{% addtoblock "js" %}
<script type="text/javascript">
//<![CDATA[
(function () {
	// save settings form plugin
	var container = 'google-map-{{ location.id }}';
	var latlng = new google.maps.LatLng('46.94708', '7.445975'); // default to switzerland

	var title = "{{ location.title }}";
	var address = "{{ location.address }}, {{ location.zipcode }} {{ location.city }}";

	var options = {
		zoom: {{ location.zoom }},
		mapTypeId: google.maps.MapTypeId.ROADMAP /* ROADMAP, SATELLITE, HYBRID or TERRAIN */
	};

{% if location.get_lat_lng %}
	// load latlng from given lat lng settings
	latlng = new google.maps.LatLng({{ location.coords|join:", " }});
	initGoogleMaps(latlng);
{% else %}
	// load latlng from given address
	var geocoder = new google.maps.Geocoder();
		geocoder.geocode({'address': address}, function (results, status) {
			// check if address can be found if not show default (var latlng)
			if(status == google.maps.GeocoderStatus.OK) latlng = results[0].geometry.location;
			initGoogleMaps(latlng);
		});
{% endif %}

	// initialize google maps
	function initGoogleMaps(latlng) {
		// overwrite options
		options.center = latlng;
		// initialize google map
		var map = new google.maps.Map(document.getElementById(container), options);
		// create marker
		var marker = new google.maps.Marker({
			'position': options.center, 
			'map': map,
			'title': title
		});
		// prepare info window
		/*var infowindow = new google.maps.InfoWindow({
			content: "<strong>" + title + "<\/strong><br />" + address {% ifnotequal map.get_content "" %} + "<br /><br /><em>{{Â object.get_content }}<\/em>"{% endifnotequal %}
		});
		// show info window
		infowindow.open(map, marker);*/
	}
})();
//]]>
</script>
{% endaddtoblock %}

{% addtoblock "css" %}
<style type="text/css">
<!--
	.google-map-container { width:50%; height:150px; display: none }
-->
</style>
{% endaddtoblock %}

<div id="google-map-{{ location.id }}" class="google-map-container"></div>

<img src="{{ location.static_url }}" />
{% endcomment %}
